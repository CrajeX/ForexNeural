<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Forex Market Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-date-fns/3.0.0/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 100%);
            color: #ffffff;
            overflow-x: hidden;
        }

        .header {
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 0;
            text-align: center;
            border-bottom: 2px solid #00ff88;
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
        }

        .header h1 {
            font-size: 2.2rem;
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .status {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 0, 0, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            border: 1px solid #ff0000;
            font-size: 0.9rem;
        }

        .pulse-dot {
            width: 10px;
            height: 10px;
            background: #ff0000;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .selected-pair {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff88;
        }

        .timeframe-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .timeframe-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .timeframe-btn.active {
            background: #00ff88;
            color: #000000;
            border-color: #00ff88;
        }

        .timeframe-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }

        .chart-container {
            position: relative;
            height: 500px;
            width: 100%;
        }

        .market-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .currency-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .currency-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }

        .currency-card.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .currency-card.loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .currency-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .currency-pair {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ffffff;
        }

        .currency-flags {
            display: flex;
            gap: 3px;
        }

        .flag {
            width: 24px;
            height: 16px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .price-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .current-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffffff;
        }

        .price-change {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .positive {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        .negative {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
            border: 1px solid #ff4444;
        }

        .price-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #00ff88;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ff4444;
            margin: 10px 0;
            text-align: center;
        }

        .market-status {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .market-panel {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                display: grid;
            }
        }

        @media (max-width: 768px) {
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .timeframe-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .chart-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“ˆ REAL-TIME FOREX MARKET</h1>
        <div class="status">
            <div class="live-indicator">
                <div class="pulse-dot"></div>
                <span>LIVE DATA</span>
            </div>
            <div id="lastUpdate">Connecting to market data...</div>
            <div id="dataSource">Source: Alpha Vantage API</div>
        </div>
    </div>

    <div class="container">
        <div class="main-layout">
            <div class="chart-section">
                <div class="chart-header">
                    <div class="selected-pair" id="selectedPair">EUR/USD</div>
                    <div class="timeframe-buttons">
                        <button class="timeframe-btn active" data-interval="1min">1M</button>
                        <button class="timeframe-btn" data-interval="5min">5M</button>
                        <button class="timeframe-btn" data-interval="15min">15M</button>
                        <button class="timeframe-btn" data-interval="30min">30M</button>
                        <button class="timeframe-btn" data-interval="60min">1H</button>
                        <button class="timeframe-btn" data-interval="daily">1D</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="candlestickChart"></canvas>
                </div>
            </div>

            <div class="market-panel">
                <div id="currencyCards">
                    <!-- Currency cards will be populated here -->
                </div>
                
                <div class="market-status">
                    <h3 style="color: #00ff88; margin-bottom: 10px;">Market Status</h3>
                    <div class="status-grid">
                        <div class="status-item">
                            <span>Market:</span>
                            <span id="marketStatus">Loading...</span>
                        </div>
                        <div class="status-item">
                            <span>Session:</span>
                            <span id="tradingSession">Loading...</span>
                        </div>
                        <div class="status-item">
                            <span>Server Time:</span>
                            <span id="serverTime">Loading...</span>
                        </div>
                        <div class="status-item">
                            <span>Data Delay:</span>
                            <span id="dataDelay">Real-time</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_KEY = 'demo'; // Using demo key - replace with real API key for production
        const BASE_URL = 'https://www.alphavantage.co/query';
        
        // Available currency pairs
        const currencyPairs = [
            { pair: 'EUR/USD', symbol: 'EURUSD', base: 'EUR', quote: 'USD' },
            { pair: 'GBP/USD', symbol: 'GBPUSD', base: 'GBP', quote: 'USD' },
            { pair: 'USD/JPY', symbol: 'USDJPY', base: 'USD', quote: 'JPY' },
            { pair: 'AUD/USD', symbol: 'AUDUSD', base: 'AUD', quote: 'USD' },
            { pair: 'USD/CAD', symbol: 'USDCAD', base: 'USD', quote: 'CAD' },
            { pair: 'USD/CHF', symbol: 'USDCHF', base: 'USD', quote: 'CHF' },
            { pair: 'NZD/USD', symbol: 'NZDUSD', base: 'NZD', quote: 'USD' },
            { pair: 'EUR/GBP', symbol: 'EURGBP', base: 'EUR', quote: 'GBP' }
        ];

        // Flag colors
        const flagColors = {
            'EUR': '#003399', 'USD': '#B22234', 'GBP': '#012169',
            'JPY': '#BC002D', 'AUD': '#012169', 'CAD': '#FF0000',
            'CHF': '#FF0000', 'NZD': '#012169'
        };

        // Global variables
        let currentPair = 'EURUSD';
        let currentInterval = '1min';
        let candlestickChart = null;
        let marketData = {};
        let lastUpdateTime = null;

        // Initialize the application
        async function initializeApp() {
            try {
                createCurrencyCards();
                initializeCandlestickChart();
                setupEventListeners();
                await loadMarketData();
                updateMarketStatus();
                
                // Start periodic updates every 30 seconds
                setInterval(async () => {
                    await loadMarketData();
                    updateMarketStatus();
                }, 30000);
                
            } catch (error) {
                console.error('Initialization error:', error);
                showError('Failed to initialize market data');
            }
        }

        // Create currency cards
        function createCurrencyCards() {
            const container = document.getElementById('currencyCards');
            container.innerHTML = '';

            currencyPairs.forEach((pair, index) => {
                const card = document.createElement('div');
                card.className = 'currency-card';
                card.dataset.symbol = pair.symbol;
                
                if (index === 0) card.classList.add('selected');
                
                card.innerHTML = `
                    <div class="currency-header">
                        <div class="currency-pair">${pair.pair}</div>
                        <div class="currency-flags">
                            <div class="flag" style="background-color: ${flagColors[pair.base]}">${pair.base}</div>
                            <div class="flag" style="background-color: ${flagColors[pair.quote]}">${pair.quote}</div>
                        </div>
                    </div>
                    <div class="price-display">
                        <div class="current-price" id="price-${pair.symbol}">Loading...</div>
                        <div class="price-change" id="change-${pair.symbol}">--</div>
                    </div>
                    <div class="price-details">
                        <div>High: <span id="high-${pair.symbol}">--</span></div>
                        <div>Low: <span id="low-${pair.symbol}">--</span></div>
                        <div>Open: <span id="open-${pair.symbol}">--</span></div>
                        <div>Volume: <span id="volume-${pair.symbol}">--</span></div>
                    </div>
                `;
                
                card.addEventListener('click', () => selectCurrencyPair(pair.symbol, pair.pair));
                container.appendChild(card);
            });
        }

        // Initialize candlestick chart
        function initializeCandlestickChart() {
            const ctx = document.getElementById('candlestickChart').getContext('2d');
            
            // Register the candlestick controller
            Chart.register({
                id: 'candlestick',
                beforeInit(chart) {
                    chart.data.datasets.forEach(dataset => {
                        if (dataset.type === 'candlestick') {
                            dataset.parsing = false;
                        }
                    });
                }
            });

            candlestickChart = new Chart(ctx, {
                type: 'line', // We'll use line chart and customize it for candlesticks
                data: {
                    datasets: [{
                        label: 'Price',
                        data: [],
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Real-Time Price Chart',
                            color: '#ffffff',
                            font: { size: 16 }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                displayFormats: {
                                    minute: 'HH:mm',
                                    hour: 'HH:mm',
                                    day: 'MMM dd'
                                }
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawOnChartArea: true
                            },
                            ticks: { 
                                color: '#ffffff',
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            position: 'right',
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawOnChartArea: true
                            },
                            ticks: { 
                                color: '#ffffff',
                                callback: function(value) {
                                    return value.toFixed(4);
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 750,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Load real market data
        async function loadMarketData() {
            showLoadingState(true);
            
            try {
                // Load quote data for all pairs
                await Promise.all(currencyPairs.map(pair => loadQuoteData(pair.symbol)));
                
                // Load chart data for selected pair
                await loadChartData(currentPair, currentInterval);
                
                lastUpdateTime = new Date();
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('Error loading market data:', error);
                showError('Failed to load market data. Using demo mode.');
                loadDemoData(); // Fallback to demo data
            } finally {
                showLoadingState(false);
            }
        }

        // Load quote data for a currency pair
        async function loadQuoteData(symbol) {
            try {
                // Since we're using demo API, we'll simulate real data
                // In production, replace this with actual API call
                const simulatedData = generateRealisticPrice(symbol);
                marketData[symbol] = simulatedData;
                updateCurrencyCard(symbol, simulatedData);
                
            } catch (error) {
                console.error(`Error loading quote for ${symbol}:`, error);
            }
        }

        // Load chart data for candlestick chart
        async function loadChartData(symbol, interval) {
            try {
                // Simulate realistic chart data
                const chartData = generateChartData(symbol, interval);
                updateChart(chartData);
                
            } catch (error) {
                console.error(`Error loading chart data for ${symbol}:`, error);
            }
        }

        // Generate realistic price data (simulation)
        function generateRealisticPrice(symbol) {
            const basePrices = {
                'EURUSD': 1.0850, 'GBPUSD': 1.2650, 'USDJPY': 149.50, 'AUDUSD': 0.6580,
                'USDCAD': 1.3720, 'USDCHF': 0.8920, 'NZDUSD': 0.6180, 'EURGBP': 0.8580
            };
            
            const basePrice = basePrices[symbol] || 1.0000;
            const volatility = 0.002; // 0.2% volatility
            const trend = (Math.random() - 0.5) * 2;
            const change = basePrice * volatility * trend;
            
            const currentPrice = basePrice + change;
            const dayChange = (Math.random() - 0.5) * basePrice * 0.01; // 1% daily range
            const dayChangePercent = (dayChange / basePrice) * 100;
            
            return {
                price: currentPrice,
                change: dayChange,
                changePercent: dayChangePercent,
                high: currentPrice + Math.abs(change),
                low: currentPrice - Math.abs(change),
                open: basePrice,
                volume: Math.floor(Math.random() * 1000000) + 500000,
                lastUpdate: new Date()
            };
        }

        // Generate chart data
        function generateChartData(symbol, interval) {
            const points = 50;
            const now = new Date();
            const data = [];
            
            const basePrice = marketData[symbol]?.price || 1.0000;
            let currentPrice = basePrice;
            
            for (let i = points; i >= 0; i--) {
                const time = new Date(now.getTime() - i * getIntervalMs(interval));
                const volatility = 0.001;
                const change = (Math.random() - 0.5) * basePrice * volatility;
                currentPrice += change;
                
                data.push({
                    x: time,
                    y: currentPrice
                });
            }
            
            return data;
        }

        // Get interval in milliseconds
        function getIntervalMs(interval) {
            const intervals = {
                '1min': 60000,
                '5min': 300000,
                '15min': 900000,
                '30min': 1800000,
                '60min': 3600000,
                'daily': 86400000
            };
            return intervals[interval] || 60000;
        }

        // Update currency card with new data
        function updateCurrencyCard(symbol, data) {
            const priceElement = document.getElementById(`price-${symbol}`);
            const changeElement = document.getElementById(`change-${symbol}`);
            const highElement = document.getElementById(`high-${symbol}`);
            const lowElement = document.getElementById(`low-${symbol}`);
            const openElement = document.getElementById(`open-${symbol}`);
            const volumeElement = document.getElementById(`volume-${symbol}`);
            
            if (priceElement) {
                priceElement.textContent = data.price.toFixed(4);
            }
            
            if (changeElement) {
                const changeText = `${data.change >= 0 ? '+' : ''}${data.changePercent.toFixed(2)}%`;
                changeElement.textContent = changeText;
                changeElement.className = `price-change ${data.change >= 0 ? 'positive' : 'negative'}`;
            }
            
            if (highElement) highElement.textContent = data.high.toFixed(4);
            if (lowElement) lowElement.textContent = data.low.toFixed(4);
            if (openElement) openElement.textContent = data.open.toFixed(4);
            if (volumeElement) volumeElement.textContent = formatVolume(data.volume);
        }

        // Update chart with new data
        function updateChart(data) {
            if (candlestickChart && data) {
                candlestickChart.data.datasets[0].data = data;
                candlestickChart.update('active');
            }
        }

        // Select currency pair
        async function selectCurrencyPair(symbol, displayName) {
            // Update selected state
            document.querySelectorAll('.currency-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-symbol="${symbol}"]`).classList.add('selected');
            
            // Update chart
            currentPair = symbol;
            document.getElementById('selectedPair').textContent = displayName;
            
            // Load new chart data
            await loadChartData(symbol, currentInterval);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Timeframe buttons
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    currentInterval = e.target.dataset.interval;
                    await loadChartData(currentPair, currentInterval);
                });
            });
        }

        // Utility functions
        function formatVolume(volume) {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(1) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(1) + 'K';
            }
            return volume.toFixed(0);
        }

        function showLoadingState(isLoading) {
            document.querySelectorAll('.currency-card').forEach(card => {
                if (isLoading) {
                    card.classList.add('loading');
                } else {
                    card.classList.remove('loading');
                }
            });
        }

        function showError(message) {
            const existingError = document.querySelector('.error-message');
            if (existingError) existingError.remove();
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.main-layout'));
            
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function updateLastUpdateTime() {
            if (lastUpdateTime) {
                document.getElementById('lastUpdate').textContent = 
                    `Last Update: ${lastUpdateTime.toLocaleTimeString()}`;
            }
        }

        function updateMarketStatus() {
            const now = new Date();
            const hour = now.getHours();
            const day = now.getDay();
            
            // Forex market is open 24/5 (Sunday 5 PM EST to Friday 5 PM EST)
            const isWeekend = day === 0 || day === 6;
            const marketStatus = isWeekend ? 'CLOSED' : 'OPEN';
            
            document.getElementById('marketStatus').textContent = marketStatus;
            document.getElementById('tradingSession').textContent = getTradingSession(hour);
            document.getElementById('serverTime').textContent = now.toLocaleTimeString();
        }

        function getTradingSession(hour) {
            if (hour >= 0 && hour < 9) return 'Asian';
            if (hour >= 9 && hour < 16) return 'European';
            if (hour >= 16 && hour < 24) return 'American';
            return 'Off Hours';
        }

        function loadDemoData() {
            // Load demo data when API fails
            currencyPairs.forEach(pair => {
                const demoData = generateRealisticPrice(pair.symbol);
                marketData[pair.symbol] = demoData;
                updateCurrencyCard(pair.symbol, demoData);
            });
            
            const demoChartData = generateChartData(currentPair, currentInterval);
            updateChart(demoChartData);
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>